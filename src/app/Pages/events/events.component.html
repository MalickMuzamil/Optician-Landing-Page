<div class="d-md-none p-3">
  <button
    class="btn btn-outline-dark bg-white"
    type="button"
    data-bs-toggle="offcanvas"
    data-bs-target="#sidebarOffcanvas"
  >
    <i class="bi bi-list fs-4 text-dark"></i>
  </button>
</div>

<div class="d-flex" style="height: 100vh; overflow: hidden">
  <app-sidebar
    style="position: sticky; top: 0; height: 100vh; flex-shrink: 0"
  ></app-sidebar>

  <div
    class="flex-grow-1 p-4 d-flex flex-column w-100"
    style="overflow-y: auto; height: 100vh"
  >
    <h2 class="mb-4 title fw-bold">Events</h2>

    <div class="mb-4 row align-items-start filter-bar">
      <div class="col-12 col-md-6 col-lg-10">
        <div class="d-flex flex-column">
          <input
            type="text"
            class="form-control w-100"
            placeholder="Search events..."
            [(ngModel)]="searchTerm"
            (keyup.enter)="onSearchChange()"
          />
          <small class="text-muted mt-1 ms-1"
            >Press <strong>Enter</strong> to search</small
          >
        </div>
      </div>

      <div class="col-12 col-md-6 col-lg-2 mt-3 mt-md-0 text-md-end">
        <button
          class="btn btn-success fw-semibold px-3 py-2"
          (click)="openEventModal()"
          [ngClass]="{ 'btn-sm': true }"
        >
          <i class="bi bi-plus me-2" style="font-size: 0.9rem"></i>
          <span class="d-none d-md-inline" style="font-size: 0.9rem"
            >Create Event</span
          >
          <span class="d-md-none">Create</span>
        </button>
      </div>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <div *ngIf="filteredEvents.length === 0" class="col">
        <div class="card h-100 shadow-lg border rounded-3">
          <div
            class="card-body d-flex justify-content-center align-items-center"
          >
            <p class="text-muted mb-0">No event found.</p>
          </div>
        </div>
      </div>

      <div class="col" *ngFor="let event of filteredEvents">
        <div class="card h-100 shadow-lg border rounded-3 custom-card">
          <div class="card-body d-flex flex-column justify-content-between">
            <div>
              <h5 class="card-title fw-bold mb-2 title">{{ event.title }}</h5>

              <p class="mb-1 small text-muted d-flex align-items-center">
                <i class="bi bi-calendar-event me-2 text-primary"></i>
                <span>
                  <strong>From:</strong>
                  {{ event.eventDateFrom | date : "MMM d, y" }}
                  <span class="mx-1 text-secondary">â†’</span>
                  <strong>To:</strong>
                  {{ event.eventDateTo | date : "MMM d, y" }}
                </span>
              </p>
              <p class="card-text mb-2 small text-secondary" [innerHTML]="event?.description">
                {{ event.description }}
              </p>

              <p class="mb-1 small">
                <strong>Time: </strong>
                <span class="sub-heading">{{ event.eventTimeFrom }}</span> -
                <span class="sub-heading">{{ event.eventTimeTo }}</span>
              </p>

              <p class="mb-1 small">
                <strong>Created By: </strong>
                <span class="text-muted">{{ event.createdByUsername }}</span>
              </p>

              <p class="mb-2 small">
                <strong>Paid: </strong>
                <span
                  class="badge"
                  [ngClass]="event.paid ? 'bg-success' : 'bg-danger'"
                  style="font-size: 0.8rem"
                >
                  {{ event.paid ? "Yes" : "No" }}
                </span>
              </p>

              <p *ngIf="event.latest" class="mb-0">
                <span class="badge bg-success">Latest Event</span>
              </p>
            </div>

            <div class="mt-3 d-flex justify-content-end">
              <button
                class="btn btn-sm btn-primary d-flex align-items-center gap-1"
                type="button"
                (click)="openEventModal(event)"
              >
                <i class="bi bi-pencil-square"></i>
                <span>Edit</span>
              </button>

              <button
                class="btn btn-sm btn-danger d-flex align-items-center gap-1"
                type="button"
                (click)="deleteEvent(event)"
              >
                <i class="bi bi-trash"></i>
                <span>Delete</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <app-pagination
      [currentPage]="currentPage"
      [totalPages]="totalPages"
      (pageChange)="onPageChange($event)"
    ></app-pagination>
  </div>
</div>

<div
  class="modal fade"
  id="eventModal"
  tabindex="-1"
  aria-labelledby="eventModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="eventModalLabel">
          {{ selectedEvent ? "Update Event" : "Create Event" }}
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <app-event-modal
          *ngIf="selectedEvent !== undefined"
          [selectedEvent]="selectedEvent"
          [kinds]="kinds"
          (formSubmitted)="onModalFormSubmitted()"
        ></app-event-modal>
      </div>
    </div>
  </div>
</div>